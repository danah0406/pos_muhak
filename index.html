<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¶•ì œ POS ì‹œìŠ¤í…œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      background: #f5f5f5;
      color: #222;
    }

    /* ìƒë‹¨ ë°” */
    .topbar {
      width: 100%;
      padding: 12px 20px;
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .topbar-title {
      font-size: 1.4rem;
      font-weight: 700;
    }

    .topbar-btns button {
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      margin-left: 8px;
      font-size: 0.95rem;
    }

    .btn-start { background: #007bff; color: #fff; }
    .btn-stop { background: #dc3545; color: #fff; }

    /* 3:7 ë ˆì´ì•„ì›ƒ */
    .layout {
      display: flex;
      height: calc(100vh - 60px);
    }

    .left {
      width: 32%;
      background: #ffffff;
      border-right: 1px solid #ddd;
      overflow-y: auto;
      padding: 12px;
    }

    .right {
      width: 68%;
      padding: 16px;
      overflow-y: auto;
    }

    /* ì£¼ë¬¸ ì¹´ë“œ */
    .order-card {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      margin-bottom: 12px;
    }

    .order-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .order-items {
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    .order-total {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .btn-done {
      background: #28a745;
      color: #fff;
      padding: 6px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* ë©”ë‰´ ì œëª© */
    .menu-group-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 16px 0 8px;
    }

    /* ë©”ë‰´ ì¹´ë“œ 3ì—´ */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .menu-btn {
      background: #ffffff;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      text-align: center;
      border: 1px solid #ddd;
      transition: 0.15s;
      font-size: 0.95rem;
      user-select: none;
    }

    .menu-btn:hover {
      background: #f0f4ff;
      transform: translateY(-2px);
    }

    .menu-name { font-weight: 600; margin-bottom: 4px; }
    .menu-price { color: #555; font-size: 0.9rem; }

    /* í˜„ì¬ ì£¼ë¬¸ */
    .current-order-box {
      background: #ffffff;
      border-radius: 12px;
      padding: 14px;
      margin-top: 18px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .order-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .qty-btn {
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #666;
      cursor: pointer;
      background: #fff;
      margin: 0 4px;
    }

    .btn-submit {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      font-size: 1.1rem;
      margin-top: 12px;
    }

    /* ë§¤ì¶œ ìš”ì•½ íŒì—… */
    .modal-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }

    .modal {
      width: 85%;
      max-width: 450px;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .modal-btn {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 12px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
    }

  </style>
</head>

<body>

  <!-- ìƒë‹¨ë°” -->
  <div class="topbar">
    <div class="topbar-title">ì¶•ì œ POS ì‹œìŠ¤í…œ</div>
    <div class="topbar-btns">
      <button class="btn-start" id="btnStart">ì¥ì‚¬ ì‹œì‘</button>
      <button class="btn-stop" id="btnStop">ì¥ì‚¬ ì¢…ë£Œ</button>
    </div>
  </div>

  <div class="layout">

    <!-- ğŸŸ¦ ì™¼ìª½ ì£¼ë¬¸ ëª©ë¡ -->
    <div class="left" id="leftOrders"></div>

    <!-- ğŸŸ§ ì˜¤ë¥¸ìª½ ì£¼ë¬¸ ì…ë ¥ -->
    <div class="right">

      <!-- ë©”ë‰´ ê·¸ë£¹: ë¶ˆë‹­ì»µ+í† í•‘ -->
      <div class="menu-group-title">ë¶ˆë‹­ì»µ & í† í•‘</div>
      <div class="menu-grid" id="menuGroup1"></div>

      <!-- ë©”ë‰´ ê·¸ë£¹: ìŒë£Œ -->
      <div class="menu-group-title">ìŒë£Œ</div>
      <div class="menu-grid" id="menuGroup2"></div>

      <!-- ê¸°íƒ€ ë©”ë‰´ -->
      <div class="menu-group-title">ê¸°íƒ€</div>
      <div class="menu-grid" id="menuGroup3"></div>

      <!-- í˜„ì¬ ì£¼ë¬¸ -->
      <div class="current-order-box">
        <div style="font-weight:700; margin-bottom:10px;">
          í˜„ì¬ ì£¼ë¬¸ (ì£¼ë¬¸ë²ˆí˜¸ <span id="currentOrderNo">1</span>ë²ˆ)
        </div>
        <div id="currentOrderList"></div>

        <div style="margin-top:10px; font-size:1.1rem; font-weight:700;">
          ì´ ê¸ˆì•¡: <span id="currentTotal">0</span>ì›
        </div>

        <button class="btn-submit" id="btnSubmitOrder">ì£¼ë¬¸ ë“±ë¡</button>
      </div>

    </div>
  </div>

  <!-- ë§¤ì¶œ ìš”ì•½ ëª¨ë‹¬ -->
  <div class="modal-bg" id="modalBg">
    <div class="modal">
      <div class="modal-title">ì˜¤ëŠ˜ ë§¤ì¶œ ìš”ì•½</div>
      <div id="salesSummary"></div>
      <button class="modal-btn" id="btnModalClose">í™•ì¸</button>
    </div>
  </div>

<script>
/* ==========================================================
      0) ë°ì´í„° êµ¬ì¡°
========================================================== */

const menuGroup1 = [
  {name:"ë¶ˆë‹­ ì»µ", price:1500},
  {name:"ë¶ˆë‹­ ê¹Œë¥´ë³´ ì»µ", price:1500},
  {name:"ì¹˜ì¦ˆ", price:500},
  {name:"í•«ë°”", price:500},
  {name:"ì½˜", price:500},
  {name:"ë§ˆìš”ë„¤ì¦ˆ", price:500},
];

const menuGroup2 = [
  {name:"ì½œë¼", price:1000},
  {name:"ì‚¬ì´ë‹¤", price:1000},
  {name:"ì¿¨í”¼ìŠ¤ ë³µìˆ­ì•„", price:1000},
  {name:"ì¿¨í”¼ìŠ¤ íŒŒì¸ì• í”Œ", price:1000},
];

const menuGroup3 = [
  {name:"ë¬´í•™ì‹œê·¸ë„ ì—¬ê³ ì†Œê°œíŒ…", price:500},
  {name:"í¼ìŠ¤ë„ì»¬ëŸ¬", price:1000},
];

/* ==========================================================
      1) ìƒíƒœ ì €ì¥ (localStorage)
========================================================== */

let state = {
  isActive: false,
  sessionClosed: false,
  currentOrderNumber: 1,
  currentOrder: {},       // {ë©”ë‰´ëª…: {price, qty}}
  activeOrders: [],       // ì™¼ìª½ ë¦¬ìŠ¤íŠ¸ì— í‘œì‹œí•  ì£¼ë¬¸ë“¤
  totalSales: 0,
  totalOrders: 0,
  salesByMenu: {}         // {ë©”ë‰´ëª…: {qty, revenue}}
};

function saveState() {
  localStorage.setItem("festivalPOS", JSON.stringify(state));
}

function loadState() {
  const saved = localStorage.getItem("festivalPOS");
  if (saved) {
    state = JSON.parse(saved);
  }
}

/* ==========================================================
      2) ì´ˆê¸° ì‹¤í–‰
========================================================== */

loadState();
updateUI();

renderMenu("menuGroup1", menuGroup1);
renderMenu("menuGroup2", menuGroup2);
renderMenu("menuGroup3", menuGroup3);

function updateUI() {
  document.getElementById("currentOrderNo").innerText = state.currentOrderNumber;
  renderCurrentOrder();
  renderLeftOrders();
}

/* ==========================================================
      3) ë©”ë‰´ ìƒì„±
========================================================== */

function renderMenu(containerId, items) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "menu-btn";
    div.innerHTML = `
      <div class="menu-name">${item.name}</div>
      <div class="menu-price">${item.price}ì›</div>
    `;
    div.onclick = () => addToCurrent(item.name, item.price);
    container.appendChild(div);
  });
}

/* ==========================================================
      4) í˜„ì¬ ì£¼ë¬¸ ê´€ë¦¬
========================================================== */

function addToCurrent(name, price) {
  if (!state.currentOrder[name]) {
    state.currentOrder[name] = {price, qty:1};
  } else {
    state.currentOrder[name].qty++;
  }
  saveState();
  renderCurrentOrder();
}

function changeQty(name, delta) {
  state.currentOrder[name].qty += delta;
  if (state.currentOrder[name].qty <= 0) {
    delete state.currentOrder[name];
  }
  saveState();
  renderCurrentOrder();
}

function renderCurrentOrder() {
  const list = document.getElementById("currentOrderList");
  list.innerHTML = "";

  let total = 0;

  const entries = Object.entries(state.currentOrder);

  entries.forEach(([name, item]) => {
    total += item.qty * item.price;

    const row = document.createElement("div");
    row.className = "order-row";
    row.innerHTML = `
      <div>${name} (${item.price}ì›)</div>
      <div>
        <button class="qty-btn" onclick="changeQty('${name}', -1)">-</button>
        ${item.qty}
        <button class="qty-btn" onclick="changeQty('${name}', 1)">+</button>
      </div>
    `;
    list.appendChild(row);
  });

  document.getElementById("currentTotal").innerText = total;
}

/* ==========================================================
      5) ì£¼ë¬¸ ë“±ë¡ â†’ ì™¼ìª½ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
========================================================== */

document.getElementById("btnSubmitOrder").onclick = submitOrder;

function submitOrder() {
  if (!state.isActive) {
    alert("ì¥ì‚¬ë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”.");
    return;
  }
  const entries = Object.entries(state.currentOrder);
  if (entries.length === 0) {
    alert("ì£¼ë¬¸í•  ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // ì´ ê¸ˆì•¡ ê³„ì‚°
  let total = 0;
  entries.forEach(([name, item]) => {
    total += item.price * item.qty;
  });

  // ì£¼ë¬¸ ê°ì²´ ìƒì„±
  const order = {
    orderNumber: state.currentOrderNumber,
    items: state.currentOrder,
    total
  };

  // ì™¼ìª½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
  state.activeOrders.push(order);

  // ë§¤ì¶œ ì§‘ê³„
  state.totalSales += total;
  state.totalOrders++;

  entries.forEach(([name, item]) => {
    if (!state.salesByMenu[name]) {
      state.salesByMenu[name] = {qty:0, revenue:0};
    }
    state.salesByMenu[name].qty += item.qty;
    state.salesByMenu[name].revenue += item.qty * item.price;
  });

  // ë‹¤ìŒ ì£¼ë¬¸ ì¤€ë¹„
  state.currentOrderNumber++;
  state.currentOrder = {};

  saveState();
  updateUI();
}

/* ==========================================================
      6) ì™¼ìª½ ì£¼ë¬¸ ëª©ë¡ + ì¤€ë¹„ì™„ë£Œ
========================================================== */

function renderLeftOrders() {
  const container = document.getElementById("leftOrders");
  container.innerHTML = "";

  state.activeOrders.forEach(order => {
    const div = document.createElement("div");
    div.className = "order-card";

    // ë©”ë‰´ ë¬¸ìì—´ êµ¬ì„±
    const itemText = Object.entries(order.items)
      .map(([name, item]) => `${name} ${item.qty}ê°œ`)
      .join(", ");

    div.innerHTML = `
      <div class="order-title">ì£¼ë¬¸ë²ˆí˜¸ ${order.orderNumber}ë²ˆ</div>
      <div class="order-items">${itemText}</div>
      <div class="order-total">ì´ ${order.total}ì›</div>
      <button class="btn-done" onclick="finishOrder(${order.orderNumber})">
        ì¤€ë¹„ì™„ë£Œ
      </button>
    `;
    container.appendChild(div);
  });
}

function finishOrder(orderNumber) {
  state.activeOrders = state.activeOrders.filter(o => o.orderNumber !== orderNumber);
  saveState();
  renderLeftOrders();
}

/* ==========================================================
      7) ì¥ì‚¬ ì‹œì‘ / ì¢…ë£Œ
========================================================== */

document.getElementById("btnStart").onclick = () => {
  // ìƒˆ ë‚  ì‹œì‘
  state.isActive = true;
  state.sessionClosed = false;
  state.currentOrderNumber = 1;
  state.activeOrders = [];
  state.currentOrder = {};
  state.totalSales = 0;
  state.totalOrders = 0;
  state.salesByMenu = {};
  saveState();
  updateUI();
};

document.getElementById("btnStop").onclick = () => {
  if (!state.isActive) return;
  state.isActive = false;
  state.sessionClosed = true;
  saveState();
  showSalesSummary();
};

/* ==========================================================
      8) ë§¤ì¶œ ìš”ì•½ ëª¨ë‹¬
========================================================== */

function showSalesSummary() {
  const summary = document.getElementById("salesSummary");

  let html = `
    <div>ì´ ì£¼ë¬¸ ê±´ìˆ˜: ${state.totalOrders}</div>
    <div>ì´ ë§¤ì¶œì•¡: ${state.totalSales}ì›</div>
    <br>
    <div><b>ë©”ë‰´ë³„ íŒë§¤ ìš”ì•½</b></div>
  `;

  Object.entries(state.salesByMenu).forEach(([name, data]) => {
    html += `
      <div>- ${name}: ${data.qty}ê°œ (${data.revenue}ì›)</div>
    `;
  });

  summary.innerHTML = html;
  document.getElementById("modalBg").style.display = "flex";
}

document.getElementById("btnModalClose").onclick = () => {
  document.getElementById("modalBg").style.display = "none";
};

</script>
</body>
</html>
